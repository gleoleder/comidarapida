<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üçó Sistema de Caja - Milanesas & Pollo</title>

    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Bebas+Neue&family=Oswald:wght@300;400;500&display=swap" rel="stylesheet">

    <!-- Estilos -->
    <link rel="stylesheet" href="styles.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- CONFIG debe cargarse ANTES que script.js -->
    <script src="config.js"></script>
    <script src="script.js"></script>

    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</head>

<body>

<!-- ==================== HEADER ==================== -->
<header class="main-header">
    <div class="header-content">
        <div class="brand">
            <div class="logo-svg">
                <svg viewBox="0 0 400 460" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <style>
                            .bread { fill: #f5d99a; }
                            .meat { fill: #d14f4f; }
                        </style>
                    </defs>
                    <path class="bread" d="M 70,120 Q 70,80 120,80 L 140,80 Q 135,90 150,95 Q 165,80 180,75 L 220,75 Q 215,90 230,95 Q 245,80 280,90 Q 330,100 330,130 L 330,135 L 70,135 Z"/>
                    <path fill="none" stroke="#e3c07c" stroke-width="12" stroke-linecap="round" d="M 75,155 Q 95,140 115,155 Q 135,170 155,155 Q 175,140 195,155 Q 215,170 235,155 Q 255,140 275,155 Q 295,170 315,155"/>
                    <rect x="65" y="175" width="270" height="30" rx="15" class="meat"/>
                    <path class="bread" d="M 75,215 L 325,215 Q 325,235 300,240 Q 200,225 180,225 Q 160,235 100,240 Q 75,235 75,215 Z"/>
                    <text x="50%" y="340" text-anchor="middle" fill="#ffffff" font-family="Oswald, sans-serif" font-size="85" font-weight="500" letter-spacing="-2">Mindy's</text>
                    <text x="50%" y="430" text-anchor="middle" fill="rgba(255,255,255,1)" font-family="Oswald, sans-serif" font-size="35" font-weight="300" letter-spacing="2">FAST FOOD</text>
                </svg>
            </div>
            <div class="brand-text">
                <h1>PUNTO DE VENTA</h1>
                <span class="tagline">Milanesas & Pollo a la Barbacoa</span>
            </div>
        </div>

        <div class="header-actions">
            <div class="datetime" id="datetime"></div>

            <div class="google-connection">
                <div class="connection-status">
                    <span class="status-dot" id="statusDot"></span>
                    <span class="status-text" id="statusText">Desconectado</span>
                </div>

                <button class="btn-google" id="btnGoogle" onclick="handleGoogleAuth()">
                    <svg viewBox="0 0 24 24" width="18" height="18">
                        <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span id="btnGoogleText">Conectar</span>
                </button>
            </div>

            <span class="user-email" id="userEmail"></span>
        </div>
    </div>
</header>

<!-- ==================== NAVEGACI√ìN ==================== -->
<nav class="main-nav">
    <button class="nav-tab active" id="tabPOS" onclick="showSection('pos')">
        <span class="nav-icon">üë©üèª‚Äçüç≥</span>
        <span class="nav-text">Ventas</span>
    </button>
    <button class="nav-tab" id="tabStats" onclick="showSection('stats')">
        <span class="nav-icon">üìä</span>
        <span class="nav-text">Estad√≠sticas</span>
    </button>
</nav>

<!-- ==================== CONTENEDOR PRINCIPAL ==================== -->
<main class="main-container">

<!-- ==================== SECCI√ìN POS ==================== -->
<section class="pos-section active" id="posSection">
    <div class="pos-layout">

        <!-- Panel de Productos -->
        <div class="products-panel">
            <div class="category-nav" id="categoryNav"></div>
            <div class="products-grid" id="productsGrid"></div>
        </div>

        <!-- Panel del Carrito -->
        <div class="cart-panel">
            <div class="cart-header">
                <h2><span class="cart-icon">üßæ</span> Orden Actual</h2>
                <span class="order-number" id="orderNumber">#0001</span>
            </div>

            <div class="cart-items" id="cartItems">
                <div class="empty-cart">
                    <div class="empty-icon">üçΩÔ∏è</div>
                    <p>Agrega productos para comenzar</p>
                </div>
            </div>

            <div class="cart-summary">
                <div class="summary-row subtotal">
                    <span>Subtotal</span>
                    <span id="subtotal">Bs. 0.00</span>
                </div>
                <div class="summary-row total">
                    <span>TOTAL</span>
                    <span id="total">Bs. 0.00</span>
                </div>
            </div>

            <div class="cart-actions">
                <button class="btn-action btn-clear" onclick="clearCart()">üóëÔ∏è Limpiar</button>
                <button class="btn-action btn-pay" id="btnPay" onclick="showPaymentModal()" disabled>üí∞ Cobrar</button>
            </div>
        </div>
    </div>
</section>

<!-- ==================== SECCI√ìN ESTAD√çSTICAS ==================== -->
<section class="stats-section" id="statsSection">

    <!-- Filtros -->
    <!-- Panel de Resumen del Turno -->
    <div class="stats-summary-panel">
        <div class="summary-header">
            <div class="summary-title">
                <span class="summary-icon">üìã</span>
                <h3>Resumen del Turno</h3>
            </div>
            <div class="shift-time">
                <span class="shift-label">Turno iniciado:</span>
                <span class="shift-value" id="shiftStartTime">--:--</span>
            </div>
        </div>
        
        <div class="last-sale-info" id="lastSaleInfo">
            <div class="last-sale-header">
                <span>üßæ √öltima Venta</span>
                <span class="last-sale-number" id="lastSaleNumber">---</span>
            </div>
            <div class="last-sale-details">
                <div class="last-sale-item">
                    <span class="label">Total:</span>
                    <span class="value" id="lastSaleTotal">Bs. 0.00</span>
                </div>
                <div class="last-sale-item">
                    <span class="label">Hora:</span>
                    <span class="value" id="lastSaleTime">--:--</span>
                </div>
                <div class="last-sale-item">
                    <span class="label">Items:</span>
                    <span class="value" id="lastSaleItems">0</span>
                </div>
            </div>
        </div>

        <div class="quick-actions-bar">
            <button class="quick-action-btn" onclick="generateDailyReport()">
                <span class="action-icon">üìä</span>
                <span class="action-text">Reporte del D√≠a</span>
            </button>
            <button class="quick-action-btn" onclick="showTopSelling()">
                <span class="action-icon">üèÜ</span>
                <span class="action-text">M√°s Vendidos</span>
            </button>
            <button class="quick-action-btn danger" onclick="confirmCloseTurn()">
                <span class="action-icon">üîí</span>
                <span class="action-text">Cerrar Turno</span>
            </button>
        </div>
    </div>

    <!-- KPIs -->
    <div class="kpi-grid">
        <div class="kpi-card orange">
            <div class="kpi-icon">üí∞</div>
            <div class="kpi-data">
                <span class="kpi-value" id="kpiSales">Bs. 0.00</span>
                <span class="kpi-label">Ventas Totales</span>
            </div>
        </div>
        <div class="kpi-card blue">
            <div class="kpi-icon">üßæ</div>
            <div class="kpi-data">
                <span class="kpi-value" id="kpiOrders">0</span>
                <span class="kpi-label">Pedidos</span>
            </div>
        </div>
        <div class="kpi-card green">
            <div class="kpi-icon">üìà</div>
            <div class="kpi-data">
                <span class="kpi-value" id="kpiAvg">Bs. 0.00</span>
                <span class="kpi-label">Ticket Promedio</span>
            </div>
        </div>
        <div class="kpi-card purple">
            <div class="kpi-icon">üçó</div>
            <div class="kpi-data">
                <span class="kpi-value" id="kpiProducts">0</span>
                <span class="kpi-label">Productos</span>
            </div>
        </div>
    </div>

    <!-- Acciones de Sincronizaci√≥n -->
    <div class="sync-actions">
        <button class="btn-sync setup" onclick="setupGoogleSheet()">‚öôÔ∏è Configurar Hoja</button>
        <button class="btn-sync primary" onclick="syncFromGoogleSheets()">üîÑ Sincronizar Datos</button>
        <button class="btn-sync" onclick="exportToCSV()">üì• Exportar CSV</button>
    </div>

    <!-- Gr√°ficos -->
    <div class="charts-grid">
        <div class="chart-card">
            <h3>üìà Ventas por D√≠a</h3>
            <div class="chart-wrapper">
                <canvas id="salesChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h3>ü•ß Ventas por Categor√≠a</h3>
            <div class="chart-wrapper">
                <canvas id="categoryChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Top Productos -->
    <div class="data-card">
        <h3>üèÜ Productos M√°s Vendidos</h3>
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Producto</th>
                        <th>Categor√≠a</th>
                        <th>Cantidad</th>
                        <th>Ingresos</th>
                    </tr>
                </thead>
                <tbody id="topProductsBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Historial -->
    <div class="data-card">
        <h3>üìã Historial de Ventas</h3>
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Pedido</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Items</th>
                        <th>Total</th>
                        <th>Pago</th>
                        <th>Cambio</th>
                    </tr>
                </thead>
                <tbody id="salesHistoryBody"></tbody>
            </table>
        </div>
    </div>
</section>

</main>

<!-- ==================== MODALES ==================== -->

<!-- Modal Acompa√±amiento -->
<div class="modal-overlay" id="sideModal">
    <div class="modal-container">
        <div class="modal-header">
            <h2>üçΩÔ∏è Elige Acompa√±amiento</h2>
            <button class="modal-close" onclick="closeSideModal()">&times;</button>
        </div>
        <p class="modal-subtitle" id="sideModalProduct"></p>
        <div class="side-options" id="sideOptions"></div>
    </div>
</div>

<!-- Modal de Pago -->
<div class="modal-overlay" id="paymentModal">
    <div class="modal-container payment-modal">
        <div class="modal-header">
            <h2>üíµ Procesar Pago</h2>
            <button class="modal-close" onclick="closePaymentModal()">&times;</button>
        </div>

        <div class="payment-total">
            <span class="label">Total a Cobrar</span>
            <span class="amount" id="paymentTotal">Bs. 0.00</span>
        </div>

        <div class="payment-input-section">
            <label>Monto Recibido</label>
            <input type="number" id="amountReceived" class="payment-input" placeholder="0.00" step="0.01" min="0" oninput="calculateChange()">
            <div class="quick-amounts">
                <button onclick="setQuickAmount(50)">Bs. 50</button>
                <button onclick="setQuickAmount(100)">Bs. 100</button>
                <button onclick="setQuickAmount(200)">Bs. 200</button>
                <button onclick="setQuickAmount('exact')">Exacto</button>
            </div>
        </div>

        <div class="change-display" id="changeDisplay">
            <span class="label">Cambio</span>
            <span class="amount" id="changeAmount">Bs. 0.00</span>
        </div>

        <div class="modal-actions">
            <button class="btn-modal secondary" onclick="closePaymentModal()">Cancelar</button>
            <button class="btn-modal primary" id="btnConfirmPay" onclick="confirmPayment()" disabled>‚úÖ Confirmar Pago</button>
        </div>
    </div>
</div>

<!-- Modal de √âxito -->
<div class="modal-overlay" id="successModal">
    <div class="modal-container success-modal">
        <div class="success-icon">‚úÖ</div>
        <h2>¬°Venta Registrada!</h2>
        <div class="success-details">
            <div class="detail-row">
                <span>Total:</span>
                <strong id="successTotal">Bs. 0.00</strong>
            </div>
            <div class="detail-row">
                <span>Recibido:</span>
                <span id="successReceived">Bs. 0.00</span>
            </div>
            <div class="detail-row highlight">
                <span>Cambio:</span>
                <strong id="successChange">Bs. 0.00</strong>
            </div>
        </div>
        <p class="sync-status" id="syncStatus"></p>
        <div class="modal-actions">
            <button class="btn-modal secondary" onclick="printTicket()">üñ®Ô∏è Imprimir</button>
            <button class="btn-modal primary" onclick="closeSuccessModal()">Nueva Venta</button>
        </div>
    </div>
</div>

<!-- ==================== TICKET PARA IMPRIMIR ==================== -->
<div class="ticket" id="ticket">
    <div class="ticket-header">
        <div class="ticket-logo">üç¥</div>
        <div class="ticket-title">Mindy's</div>
        <div class="ticket-subtitle">FAST FOOD</div>
        <div class="ticket-divider">================================</div>
        <div class="ticket-info">
            <div id="ticketDate"></div>
            <div id="ticketTime"></div>
            <div>Pedido: <strong id="ticketNumber"></strong></div>
        </div>
        <div class="ticket-divider">================================</div>
    </div>
    <div class="ticket-items" id="ticketItems"></div>
    <div class="ticket-divider">--------------------------------</div>
    <div class="ticket-totals">
        <div class="ticket-total">TOTAL: <strong id="ticketTotal"></strong></div>
        <div class="ticket-payment">
            <div>Recibido: <span id="ticketReceived"></span></div>
            <div>Cambio: <span id="ticketChange"></span></div>
        </div>
    </div>
    <div class="ticket-divider">================================</div>
    <div class="ticket-footer">
        <div>¬°GRACIAS POR SU COMPRA!</div>
        <div class="ticket-note">Este documento no es factura</div>
    </div>
</div>

<!-- ==================== TOAST ==================== -->
<div class="toast" id="toast">
    <span class="toast-icon" id="toastIcon">‚úÖ</span>
    <span class="toast-message" id="toastMessage"></span>
</div>

<!-- ==================== LOADING ==================== -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loadingText">Cargando...</div>
</div>

</body>
</html>
